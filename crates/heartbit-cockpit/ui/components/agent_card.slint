import { VerticalBox, HorizontalBox } from "std-widgets.slint";

export struct AgentState {
    name: string,
    // "idle", "thinking", "executing", "completed", "failed", "cancelled"
    status: string,
    current-turn: int,
    max-turns: int,
    tool-name: string,
    tokens-in: string,
    tokens-out: string,
    // 0.0 to 1.0 — fraction of turn budget consumed
    turn-fraction: float,
    // true when this agent is selected as the message filter
    selected: bool,
}

component StatusDot inherits Rectangle {
    in property <string> status;
    width: 10px;
    height: 10px;
    border-radius: 5px;
    background: status == "thinking" ? #f59e0b :
                status == "executing" ? #3b82f6 :
                status == "completed" ? #10b981 :
                status == "failed" ? #ef4444 :
                status == "cancelled" ? #f97316 :
                #6b7280;
}

export component AgentCard inherits Rectangle {
    in property <AgentState> agent;
    callback clicked();
    background: agent.selected ? #1e3a5f : ta.has-hover ? #263548 : #1e293b;
    border-radius: 8px;
    border-width: agent.selected ? 1px : 0px;
    border-color: #3b82f6;
    vertical-stretch: 0;

    ta := TouchArea {
        clicked => { root.clicked(); }
    }

    VerticalBox {
        padding: 12px;
        spacing: 6px;

        HorizontalBox {
            spacing: 8px;
            alignment: start;
            StatusDot { status: agent.status; }
            Text {
                text: agent.name;
                color: #e2e8f0;
                font-size: 14px;
                font-weight: 600;
            }
        }

        Text {
            text: agent.status == "idle" ? "Idle" :
                  agent.status == "executing" ? "Tool: " + agent.tool-name :
                  agent.status == "thinking" ? "Thinking..." :
                  agent.status == "completed" ? "Done" :
                  agent.status == "failed" ? "Failed" :
                  agent.status == "cancelled" ? "Cancelled" : "";
            color: #94a3b8;
            font-size: 12px;
        }

        if agent.max-turns > 0 : VerticalLayout {
            spacing: 4px;

            HorizontalBox {
                spacing: 12px;
                Text {
                    text: "Turn " + agent.current-turn + "/" + agent.max-turns;
                    color: #64748b;
                    font-size: 11px;
                }
                if agent.tokens-in != "0" || agent.tokens-out != "0" : Text {
                    text: agent.tokens-in + "↓ " + agent.tokens-out + "↑";
                    color: #64748b;
                    font-size: 11px;
                }
            }

            // Turn budget progress bar
            if agent.turn-fraction > 0 : Rectangle {
                height: 3px;
                background: #334155;
                border-radius: 2px;

                Rectangle {
                    width: parent.width * min(agent.turn-fraction, 1.0);
                    height: parent.height;
                    background: agent.turn-fraction < 0.5 ? #10b981 :
                               agent.turn-fraction < 0.8 ? #f59e0b : #ef4444;
                    border-radius: 2px;
                }
            }
        }
    }
}
